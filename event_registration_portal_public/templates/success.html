<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Successful</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">ğŸ“ Event Registration Portal</h1>
            <ul class="nav-links">
                <li><a href="{{ url_for('index') }}">Register</a></li>
                <li><a href="{{ url_for('registered_students_page') }}">Registered Students</a></li>
                <li><a href="{{ url_for('admin_login') }}">Admin Login</a></li>
            </ul>
        </div>
    </nav>

    <div class="container main-content">
        <div class="success-card">
            <div class="success-icon">âœ…</div>
            <h2>Registration Successful!</h2>
            <p class="success-message">Thank you for registering, <strong>{{ student.name }}</strong>!</p>
            
            <div class="student-details">
                <h3>Your Registration Details</h3>
                
                <div class="detail-row">
                    <span class="label">ğŸ« Registration ID:</span>
                    <span class="value"><strong>{{ student.registration_id }}</strong></span>
                </div>
                
                <div class="detail-row">
                    <span class="label">ğŸ‘¤ Name:</span>
                    <span class="value">{{ student.name }}</span>
                </div>
                
                <div class="detail-row">
                    <span class="label">ğŸ”¢ Register Number:</span>
                    <span class="value">{{ student.register_number }}</span>
                </div>
                
                <div class="detail-row">
                    <span class="label">ğŸ›ï¸ Department:</span>
                    <span class="value">{{ student.department }}</span>
                </div>
                
                <div class="detail-row">
                    <span class="label">ğŸ“… Year:</span>
                    <span class="value">{{ student.year }}</span>
                </div>
                
                <div class="detail-row">
                    <span class="label">ğŸ“± Phone:</span>
                    <span class="value">{{ student.phone }}</span>
                </div>
                
                <div class="detail-row full-width">
                    <span class="label">ğŸ¯ Events Registered:</span>
                </div>
                
                {% for event in student.event_details %}
                <div class="event-detail-card">
                    <div class="event-detail-name">{{ event.name }}</div>
                    <div class="event-detail-info">
                        <span>ğŸ• {{ event.time }}</span>
                        <span>ğŸ“ {{ event.venue }}</span>
                    </div>
                </div>
                {% endfor %}
                
                <div class="detail-row">
                    <span class="label">ğŸ“† Event Date:</span>
                    <span class="value">{{ student.date }}</span>
                </div>
            </div>
            
            <div class="action-buttons">
                <a href="{{ url_for('index') }}" class="btn btn-secondary">
                    ğŸ  Back to Home
                </a>
                <a href="{{ url_for('registered_students_page') }}" class="btn btn-info">
                    ğŸ‘¥ View All Registrations
                </a>
            </div>
        </div>
    </div>

    <!-- QR Code Section -->
    <div class="container qr-section">
        <div class="qr-card">
            <h3>ğŸ“± Share with Friends</h3>
            <p class="qr-description">Share this QR code so others can register too!</p>
            <div class="qr-status" id="qr-status"></div>
            <div id="qrcode" class="qr-container"></div>
            <div class="qr-url" id="qr-url-display">Loading...</div>
            <p class="qr-instructions" id="qr-instructions">
                ğŸ“² <strong>How to scan:</strong><br>
                Open your mobile camera or QR code scanner app and point it at the QR code above
            </p>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Event Registration Portal. All rights reserved.</p>
    </footer>

    <script>
        // Generate QR Code
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/get-server-url')
                .then(response => response.json())
                .then(data => {
                    const serverUrl = data.url;
                    const connectionType = data.type;
                    
                    document.getElementById('qr-url-display').textContent = serverUrl;
                    
                    const statusDiv = document.getElementById('qr-status');
                    if (connectionType === 'public') {
                        statusDiv.innerHTML = '<span class="status-public">âœ… PUBLIC ACCESS - Share with anyone!</span>';
                        statusDiv.className = 'qr-status status-public-box';
                        document.getElementById('qr-instructions').innerHTML = 
                            'ğŸ“² <strong>Share anywhere!</strong><br>Works on mobile data, any WiFi - perfect for sharing!';
                    } else {
                        statusDiv.innerHTML = '<span class="status-local">ğŸ  LOCAL ACCESS - Same WiFi Only</span>';
                        statusDiv.className = 'qr-status status-local-box';
                    }
                    
                    new QRCode(document.getElementById("qrcode"), {
                        text: serverUrl,
                        width: 200,
                        height: 200,
                        colorDark: "#1e3a8a",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                })
                .catch(error => {
                    console.error('Error generating QR code:', error);
                    document.getElementById('qr-url-display').textContent = 'Error loading QR code';
                });
        });
    </script>
</body>
</html>
