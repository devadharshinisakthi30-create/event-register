<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Registration Portal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">ğŸ“ Event Registration Portal</h1>
            <ul class="nav-links">
                <li><a href="{{ url_for('index') }}" class="active">Register</a></li>
                <li><a href="{{ url_for('registered_students_page') }}">Registered Students</a></li>
                <li><a href="{{ url_for('admin_login') }}">Admin Login</a></li>
            </ul>
        </div>
    </nav>

    <div class="container main-content">
        <div class="registration-card">
            <div class="card-header">
                <h2>ğŸ“‹ Student Event Registration</h2>
                <p>Fill in your details to register for IT events</p>
            </div>
            
            <form action="{{ url_for('register') }}" method="POST" class="registration-form">
                <div class="form-section">
                    <h3>Personal Information</h3>
                    
                    <div class="form-group">
                        <label for="name">ğŸ‘¤ Full Name *</label>
                        <input type="text" id="name" name="name" required placeholder="Enter your full name">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">ğŸ“± Phone Number *</label>
                            <input type="tel" id="phone" name="phone" required placeholder="10-digit number" pattern="[0-9]{10}">
                        </div>

                        <div class="form-group">
                            <label for="register_number">ğŸ”¢ Register Number *</label>
                            <input type="text" id="register_number" name="register_number" required placeholder="e.g., 2021CS001">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Academic Details</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="department">ğŸ›ï¸ Department *</label>
                            <select id="department" name="department" required>
                                <option value="">Select Department</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Information Technology">Information Technology</option>
                                <option value="Electronics and Communication">Electronics and Communication</option>
                                <option value="Electrical Engineering">Electrical Engineering</option>
                                <option value="Mechanical Engineering">Mechanical Engineering</option>
                                <option value="Civil Engineering">Civil Engineering</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="year">ğŸ“… Year of Study *</label>
                            <select id="year" name="year" required>
                                <option value="">Select Year</option>
                                <option value="I">I Year</option>
                                <option value="II">II Year</option>
                                <option value="III">III Year</option>
                                <option value="IV">IV Year</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="college">ğŸ« College Name *</label>
                        <input type="text" id="college" name="college" required placeholder="Enter your college name">
                    </div>
                </div>

                <div class="form-section">
                    <h3>Event Selection</h3>
                    
                    <div class="form-group">
                        <label>ğŸ¯ Select Events * (You can select multiple)</label>
                        <div class="events-grid">
                            {% for event_name, details in events.items() %}
                            <div class="event-checkbox">
                                <input type="checkbox" id="event_{{ loop.index }}" name="events" value="{{ event_name }}">
                                <label for="event_{{ loop.index }}" class="event-label">
                                    <div class="event-name">{{ event_name }}</div>
                                    <div class="event-details">
                                        <span class="time">ğŸ• {{ details.time }}</span>
                                        <span class="venue">ğŸ“ {{ details.venue }}</span>
                                    </div>
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="date">ğŸ“† Event Date *</label>
                        <input type="date" id="date" name="date" required>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">âœ… Register Now</button>
                    <button type="reset" class="btn btn-secondary">ğŸ”„ Reset Form</button>
                </div>
            </form>
        </div>
    </div>

    <!-- QR Code Section -->
    <div class="container qr-section">
        <div class="qr-card">
            <h3>ğŸ“± Scan to Access on Mobile</h3>
            <p class="qr-description">Scan this QR code with your mobile device to open the registration portal</p>
            <div class="qr-status" id="qr-status"></div>
            <div id="qrcode" class="qr-container"></div>
            <div class="qr-url" id="qr-url-display">Loading...</div>
            <p class="qr-instructions" id="qr-instructions">
                ğŸ“² <strong>How to scan:</strong><br>
                Open your mobile camera or QR code scanner app and point it at the QR code above
            </p>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Event Registration Portal. All rights reserved.</p>
    </footer>

    <script>
        // Generate QR Code
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch server URL
            fetch('/get-server-url')
                .then(response => response.json())
                .then(data => {
                    const serverUrl = data.url;
                    const connectionType = data.type;
                    const message = data.message;
                    
                    // Display URL
                    document.getElementById('qr-url-display').textContent = serverUrl;
                    
                    // Display connection status
                    const statusDiv = document.getElementById('qr-status');
                    if (connectionType === 'public') {
                        statusDiv.innerHTML = '<span class="status-public">âœ… PUBLIC ACCESS - Works on Mobile Data!</span>';
                        statusDiv.className = 'qr-status status-public-box';
                        document.getElementById('qr-instructions').innerHTML = 
                            'ğŸ“² <strong>Works on ANY network!</strong><br>' +
                            'This QR code works on mobile data, WiFi, or any network. ' +
                            'Users don\'t need to be on the same WiFi!';
                    } else {
                        statusDiv.innerHTML = '<span class="status-local">ğŸ  LOCAL ACCESS - Same WiFi Only</span>';
                        statusDiv.className = 'qr-status status-local-box';
                        document.getElementById('qr-instructions').innerHTML = 
                            'ğŸ“² <strong>How to scan:</strong><br>' +
                            'Open your mobile camera or QR code scanner app and point it at the QR code above.<br>' +
                            '<em>Note: Your mobile must be on the same WiFi network.</em>';
                    }
                    
                    // Generate QR Code
                    new QRCode(document.getElementById("qrcode"), {
                        text: serverUrl,
                        width: 200,
                        height: 200,
                        colorDark: "#1e3a8a",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                })
                .catch(error => {
                    console.error('Error generating QR code:', error);
                    document.getElementById('qr-url-display').textContent = 'Error loading QR code';
                });
        });
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
